{% extends 'base.html' %}
{% block title %}–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞{% endblock %}

{% block content %}
<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
<div class="mb-8">
    <h1 class="text-3xl font-bold mb-2 text-blue-400">
        üèÜ –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞: {{ category.name }}
    </h1>
    <p class="text-gray-400">{{ tournament.name }} ‚Ä¢ {{ tournament.date|date:"d.m.Y" }}</p>
</div>

{% if error %}
<!-- –û—à–∏–±–∫–∞ -->
<div class="bg-red-900/30 border border-red-500 rounded-lg p-6 text-center">
    <p class="text-red-400 text-lg">{{ error }}</p>
    {% if user.is_staff %}
    <a href="{% url 'grid:generate' category.id %}" 
       class="inline-block mt-4 bg-blue-600 hover:bg-blue-500 text-white py-2 px-6 rounded transition">
        –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–∫—É
    </a>
    {% endif %}
</div>

{% elif grid %}
<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–∫–µ -->
<div class="bg-gray-800 rounded-lg p-6 mb-6 border border-gray-700">
    <div class="flex justify-between items-center">
        <div>
            <p class="text-gray-400 mb-1">–¢–∏–ø —Å–µ—Ç–∫–∏</p>
            <p class="text-white font-semibold text-lg">{{ grid.get_grid_type_display }}</p>
        </div>
        <div>
            <p class="text-gray-400 mb-1">–í—Å–µ–≥–æ –º–∞—Ç—á–µ–π</p>
            <p class="text-white font-semibold text-lg">{{ grid.matches.count }}</p>
        </div>
        {% if user.is_staff %}
        <a href="{% url 'grid:generate' category.id %}" 
           class="bg-blue-600 hover:bg-blue-500 text-white py-2 px-4 rounded transition text-sm">
            –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–µ—Ç–∫—É
        </a>
        {% endif %}
    </div>
</div>

<!-- –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ -->
{% if bracket_structure %}
<div class="overflow-x-auto">
    <div class="flex gap-6 pb-4">
        {% for round in bracket_structure %}
        <div class="flex-shrink-0" style="min-width: 300px;">
            <h3 class="text-xl font-semibold text-blue-300 mb-4 text-center">
                {{ round.display_name }}
            </h3>
            
            <div class="space-y-4">
                {% for match in round.matches %}
                <div class="bg-gray-800 rounded-lg p-4 border {% if match.is_completed %}border-green-600{% else %}border-gray-700{% endif %}">
                    <div class="text-xs text-gray-400 mb-2">
                        –ë–æ–π #{{ match.match_number }}
                    </div>
                    
                    <!-- –°–ø–æ—Ä—Ç—Å–º–µ–Ω 1 -->
                    <div class="mb-2 p-2 rounded {% if match.winner == match.athlete1 %}bg-green-900/30{% else %}bg-gray-700{% endif %}">
                        {% if match.athlete1 %}
                        <p class="font-semibold text-white text-sm">
                            {{ match.athlete1.full_name }}
                        </p>
                        <p class="text-xs text-gray-400">{{ match.athlete1.school }}</p>
                        {% else %}
                        <p class="text-gray-500 text-sm italic">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è</p>
                        {% endif %}
                        {% if match.is_completed %}
                        <p class="text-right text-lg font-bold {% if match.winner == match.athlete1 %}text-green-400{% else %}text-gray-400{% endif %}">
                            {{ match.score_athlete1 }}
                        </p>
                        {% endif %}
                    </div>
                    
                    <div class="text-center text-gray-600 text-xs my-1">vs</div>
                    
                    <!-- –°–ø–æ—Ä—Ç—Å–º–µ–Ω 2 -->
                    <div class="p-2 rounded {% if match.winner == match.athlete2 %}bg-green-900/30{% else %}bg-gray-700{% endif %}">
                        {% if match.athlete2 %}
                        <p class="font-semibold text-white text-sm">
                            {{ match.athlete2.full_name }}
                        </p>
                        <p class="text-xs text-gray-400">{{ match.athlete2.school }}</p>
                        {% else %}
                        <p class="text-gray-500 text-sm italic">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è</p>
                        {% endif %}
                        {% if match.is_completed %}
                        <p class="text-right text-lg font-bold {% if match.winner == match.athlete2 %}text-green-400{% else %}text-gray-400{% endif %}">
                            {{ match.score_athlete2 }}
                        </p>
                        {% endif %}
                    </div>
                    
                    <!-- –°—Ç–∞—Ç—É—Å -->
                    <div class="mt-3 pt-3 border-t border-gray-700">
                        {% if match.is_completed %}
                        <div class="text-xs text-green-400 text-center">
                            ‚úì –ó–∞–≤–µ—Ä—à—ë–Ω
                            {% if match.result_type %}
                            <span class="text-gray-400">‚Ä¢ {{ match.get_result_type_display }}</span>
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="text-xs text-blue-400 text-center">
                            ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if user.is_staff and not match.is_completed and match.athlete1 and match.athlete2 %}
                    <a href="{% url 'grid:update_result' match.id %}" 
                       class="block mt-2 text-center bg-blue-600 hover:bg-blue-500 text-white py-1 px-3 rounded text-xs transition">
                        –í–Ω–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="bg-gray-800 rounded-lg p-12 text-center border border-gray-700">
    <p class="text-gray-500">–ú–∞—Ç—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
</div>
{% endif %}

{% else %}
<!-- –°–µ—Ç–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ -->
<div class="bg-gray-800 rounded-lg p-12 text-center border border-gray-700">
    <p class="text-gray-500 text-lg">–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞</p>
</div>
{% endif %}

<!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
<div class="mt-6">
    <a href="{% url 'tournament:categories' tournament.id %}" 
       class="inline-block bg-gray-700 hover:bg-gray-600 text-white py-2 px-6 rounded transition">
        ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    </a>
</div>
{% endblock %}